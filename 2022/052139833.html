<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="操作系统文件管理, Springboot,java,HTML,Vue,linux等">
    <meta name="description" content="操作系统文件管理，概念，文件逻辑结构，目录结构，文件共享，文件保护，实现，磁盘。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    
    <style>
        body{
            background-image: url(/medias/bg.png);
            background-repeat:no-repeat;
            background-size: 100% 100%;
            background-attachment:fixed;
        }
    </style>


    <title>操作系统文件管理 | FFFfrance&#39;s Blog</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/guixinchn/image/blog/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="FFFfrance's Blog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://cdn.jsdelivr.net/gh/guixinchn/image/blog/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">FFFfrance&#39;s Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://cdn.jsdelivr.net/gh/guixinchn/image/blog/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">FFFfrance&#39;s Blog</div>
        <div class="logo-desc">
            
            个人分享博客，总结开发经验，记录生活点滴
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">操作系统文件管理</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
                                <span class="chip bg-color">操作系统</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="post-category">
                                操作系统
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-05-21
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-05-22
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    6.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    22 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h1><img src="/2022/052139833/1.jpg" class="">   
<h2 id="文件系统基础"><a href="#文件系统基础" class="headerlink" title="文件系统基础"></a>文件系统基础</h2><h3 id="文件的概念"><a href="#文件的概念" class="headerlink" title="文件的概念"></a>文件的概念</h3><ul>
<li>文件的定义：<br>以计算机硬盘为载体的存储在计算机上的信息集合。系统运行时，计算机以进程为基本单位斤西瓜资源的调度和分配，而在用户进行的输入输出中，则以文件为基本单位。当用户把文件用于用户程序的输入输出时，希望还可以访问，修改，保存文件等，实现对于文件的维护管理，需要OS中的文件系统。<br>文件由存储空间中的数据，分类和索引信息，访问权限信息组成。用户通过文件系统建立文件，提供程序的输入输出，对资源进行管理，首先了解文件结构，通过自底向上的方式来定义：<br>①数据项：文件系统中最低级的数据组织形式，分为基本数据项（描述一个对象某个值，是数据中可命名的最小逻辑数据单元，即原子数据）和组合数据项（由多个基本数据项组成）。<br>②记录：一组相关数据项集合，描述一个对象在某方面的属性（考生信息一系列域）。<br>③文件：指由创建者所定义的一组相关信息集合，逻辑上分为有结构文件（文件由一组相似记录组成，又叫记录式文件）和无结构文件（视为一个字符流，又称流式文件）。</li>
<li>文件的属性：<br>系统不同属性也不同，但通常包括：<br>①名称：文件名称唯一，以易读取形式保存。<br>②标识符：标识文件系统内文件的唯一标签，通常为数字，对人不可读。<br>③类型：被支持不同类型的文件系统所使用。<br>④位置：指向设备和设备上文件的指针。<br>⑤大小：文件当前大小，也可包括文件允许的最大值。<br>⑥保护：对文件进行保护的访问控制信息。<br>⑦时间，日期和用户标识：文件创建，上次修改，上次访问的相关信息，用于保护跟踪文件使用。<br>所有文件的信息都保存在目录结构中，目录结构保存在外存中，文件信息需要时才调入内存，通常，目录条目包括文件名称以及唯一标识符，二标识符定位其他属性信息。  </li>
<li>文件的基本操作：<br>OS提供系统调用，对文件进行创建，写，读，重定位，删除，截断等操作。（基本操作组合可以执行其他文件操作）<br>①创建文件：①文件系统为文件找到空间。②目录中为文件创建新条目，记录文件名称和标识符等其他信息。<br>②写文件：执行系统调用，指明文件名称和要写内容，系统维护一个写位置的指针，写操作时更新写指针。<br>③读文件：执行系统调用，指明文件内容和要读文件快的内存位置，系统维护一个读位置的指针，读操作时更新读指针，读写使用同一个指针。<br>④文件重定位：按照某条件搜索目录，把当前文件位置设置为给定值，并且不会读写文件。<br>⑤删除文件：从目录找出删除文件的目录项，实质称为空项目，回收文件存储空间。<br>⑥截断文件：允许文件所有属性不变，并删除文件内容，即长度设置为0并释放其空间。  </li>
<li>文件打开和关闭：<br>许多系统要求首次使用文件时，系统调用open将指明文件的属性从外存复制到内存，打开文件表的一个条目，把表目编号返回给用户，OS维护一个包含所有打开文件信息的表（打开文件表），需要文件操作时可以通过该表的一个索引指定文件，省略搜索环境，不再使用可以关闭它，OS打开文件表删除这个条目。open会根据文件名搜索牡蛎，并把目录条目复制到打开文件表，open返回一个指向打开文件表中的一个条目的指针，通过这个指针进行所有IO操作，之后对于文件任何操作不需要文件名字，只需要open调用返回的指针。<br>通常OS还用一个文件打开计数器Open Count，记录多少进程打开了该文件，打开计数器为0标识不再使用，系统回收系统资源。若文件被修改过，文件写回外存，并把打开文件表相应条目删除，最后释放文件的文件控制块FCB。<br>每个打开文件都有相关关联信息：<br>①文件指针：文件当前位置的指针，打开文件某个进程是唯一的。<br>②文件打开计数：上文解释过。<br>③文件磁盘位置：绝大数文件操作要求改变文件，该信息保存在内存中，以免每个操作都从磁盘中获取。<br>④访问权限：每个进程打开文件都要有访问模式（创建，只读，读写等），该信息保存在进程打开文件表中，以便OS可以允许/拒绝IO请求。   <h3 id="文件的逻辑结构"><a href="#文件的逻辑结构" class="headerlink" title="文件的逻辑结构"></a>文件的逻辑结构</h3></li>
<li>逻辑结构就是用户观点看到的文件组织形式。物理结构则是实现观点出发看到的文件在外存上的存储组织形式。逻辑结构上，文件划分无结构文件和有结构文件两种：</li>
<li>无结构文件（流式文件）：<br>最简单的文件组织形式，把数据按照顺序组织成记录并积蓄保存，它是有序相关信息项的集合，以字节为单位。记录访问只能穷举搜索，适用于对基本信息单位操作不多的文件（如源程序文件，目标代码文件等）  </li>
<li>有结构文件（记录式文件）：<br>按照记录的组织形式可以分为：<br>①顺序文件：记录顺序排列，通常是定长的，可以顺序/链式存储，访问时顺序搜索文件。有两种结构：第一种是串结构：存入时间先后排列。第二种是顺序结构：按照关键字顺序排列。对于记录批量操作时，顺序文件操作效率最高，此外也只有顺序文件才能存在磁带上，但对于单条记录操作就比较困难。<br>②索引文件：对于定长记录文件和可变长记录文件，查找第i条记录地址不一样。变长记录文件只能顺序查找，系统开销大，为此可以建立一张索引表加速检索。  <img src="/2022/052139833/2.jpg" class="">   
③索引顺序文件：顺序和索引两种组织形式结合，把顺序文件所有记录分为若干组，建立一张索引表，表为每组第一个记录建立一个索引项，其中含有该记录的关键字值和指向该记录的指针。同一组的关键字可以无序，但组索引必须有序，先找到组再顺序查找。  <img src="/2022/052139833/3.jpg" class="">   
提高了查找效率，但配置索引表增加了存储空间。<br>④直接文件/散列文件（Hash File）：给定记录的键值/通过散列函数转换的键值直接决定记录的物理地址，没有顺序的特性，有很高的存取速度但有冲突。  <h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3></li>
<li>包含文件信息，这些信息由OS管理。用户角度：目录需要在文件名和文件之间有映射，目录存取效率直接影响系统性能，所以要提高用户检索速度，共享系统中，目录还需要提供用于控制访问文件的信息，重名也是合理的要求，通过树形结构来解决和实现。  </li>
<li>文件控制块和索引结点：<br>为了实现目录管理，OS引入了文件控制块的数据结构。<br>①文件控制块FCB，用来存放控制文件所需要各种信息的数据结构，以实现“按名存取”。FCB的有序集合称为文件目录，一个FCB就是一个文件目录项，创建新文件则分配一个FCB并存放在文件目录中，成为目录项。主要包括：基本信息（名字，物理位置，逻辑结构等），存取控制信息（文件存取权限等），使用信息（创建修改时间等）。<br>②索引结点：检索目录文件过程中，只用到了文件名，仅当找到一个目录项时，才需要从该目录读取其物理地址，也就是其他描述信息没用到，所以有的OS采用文件名和描述分开方法，描述信息单独形成一个称为索引结点的数据结构，在文件目录中每个目录项仅由文件名和指向该文件的所对应i结点的指针构成。存放在磁盘上的索引结点称为磁盘索引结点，UNIX每个文件都由一个唯一的磁盘索引结点，主要包括：文件主标识符，文件类型，文件存取权限，文件物理地址，文件长度（以字节为单位），文件链接计数（指向该文件的指针计数），文件存取时间。<br>文件被打开时，磁盘索引结点复制到内存的索引结点以便于使用，在内存索引节点又增加了内容：索引结点编号（标识内存索引结点），状态（结点是否上锁或修改），访问计数，逻辑设备号，链接指针。  </li>
<li>目录结构：<br>考虑目录层次的操作:搜索，创建文件，删除文件，显示目录，修改目录。考虑以下几种目录结构：<br>①单级目录结构：<br>整个文件系统只有一个目录表，每个文件占一个目录项。  <img src="/2022/052139833/4.jpg" class="">   
访问文件，先按照文件名找到对应FCB，创建文件必须检索所有目录项以确保没有重名，删除文件回收存储空间再清楚目录项。单级目录实现了“按名存取”，但速度慢，无重名，不便于用户共享。<br>②两级目录结构：<br>把文件目录分为主文件目录MFD和用户文件目录UFD。  <img src="/2022/052139833/5.jpg" class="">   
主文件目录记录用户名和相应文件目录所在存储位置，而用户文件目录记录相应用户文件目录的FCB信息，当用户相对其文件访问时只需要搜索该用户对应的UFD，解决了重名问题，保证安全，但缺乏灵活性，不能对文件分类。<br>③多级目录结构（树形目录结构）：<br>用户访问某个文件，用文件路径名标识文件，用“/”分隔开，从根目录出发的路径为绝对路径。而从当前目录出发到所找文件通路的路径为相对路径。  <img src="/2022/052139833/6.jpg" class="">   
很方便对于文件分配，层次清晰，但查找时需要逐次访问中间结点，增加磁盘访问次数，影响速度。<br>④无环图目录结构：<br>树形结构不利于文件共享，所以在树形结构基础上增加指向同一结点的有向边，使得整个目录成为一个有向无环图，为了实现文件共享。  <img src="/2022/052139833/7.jpg" class="">   
<h3 id="文件共享"><a href="#文件共享" class="headerlink" title="文件共享"></a>文件共享</h3>使多个用户共享同一个文件，系统只需要保留一个副本。常用两种方法：  </li>
<li>基于索引结点的共享方式（硬链接）：<br>在树形结构目录中，当两个或多个用户要共享一个子目录/文件时，必须把共享文件或子目录链接到这些用户目录中，才能方便找到该文件。<br>文件的其他信息都放在索引结点中，而目录中只有文件名和指向相应索引节点的指针，索引节点还有count来计数链接到本索引结点的用户目录项数。  <img src="/2022/052139833/8.jpg" class="">   </li>
<li>利用符号链实现文件共享（软链接）：<br>系统创建一个LINK类型的新文件，写入共享用户B的目录中，实现B的目录与文件F的链接，新文件中只包含被链接文件的路径名，这种方法称为符号链接。新文件中的路径名视为符号链，根据路径名读取文件，从而实现对文件的共享。<br>在利用符号链方式实现文件共享时，只有文件拥有者才拥有指向其索引节点的指针，而共享该文件的其他用户只有该文件的路径名。但仍然有一点问题，删除该文件且再次创建一样文件，软链接仍然有效。有个优点就是网络共享只需要提供该文件所在及其的网络地址及该及其中的文件路径。  <h3 id="文件保护"><a href="#文件保护" class="headerlink" title="文件保护"></a>文件保护</h3>为了防止文件共享可能会导致文件被破坏或未经核准的用户修改文件，文件系统必须控制用户对文件的存取，即解决对文件的读，写，执行的许可问题，为此必须在文件系统中建立相应的文件保护机制。文件保护通过口令保护，加密保护，访问控制等方式实现，其中口令和加密为了防止用户文件被他人存取或窃取，而访问控制用于控制用户对于文件访问方式。  </li>
<li>访问类型：<br>读，写，执行（文件装入内存并执行），添加，删除，列表清单（列出文件名和属性），还有其他高级操作（通过掉哟个底层系统调用来实现）。</li>
<li>访问控制：<br>最常用方法就是根据用户身份进行控制，为每个文件增加一个访问控制列表ACL，以规定每个用户名及其所允许的访问类型，精简的访问列表有：拥有者（创建文件用户），组（一组内需要共享文件且具有类似访问的用户），其他（系统内的所有其他用户）。用三个域列出访问表三类用户访问权限。<br>口令和密码时另外两种访问控制：<br>①口令指用户建立一个文件时提供一个口令，系统为其建立FCB时附上口令，且告诉共享文件的其他用户，用户请求访问时必须提供相应口令，缺点是口令存在系统内部不安全。<br>②密码则是对文件加密，访问需要密钥，保密性强但编码和译码需要花费时间。<h2 id="文件系统的实现"><a href="#文件系统的实现" class="headerlink" title="文件系统的实现"></a>文件系统的实现</h2><h3 id="文件系统层次结构"><a href="#文件系统层次结构" class="headerlink" title="文件系统层次结构"></a>文件系统层次结构</h3>现代OS有很多种文件系统类型，因此文件系统层次结构也不尽相同。  <img src="/2022/052139833/9.jpg" class="">   </li>
<li>用户调用接口：<br>文件系统为用户提供与文件及目录有关的调用。此层由若干程序模块组成，每个模块对应一条系统调用，用户发出一条调用，控制即转入相应的模块。  </li>
<li>文件目录系统：<br>管理文件目录，任务有管理活跃文件目录表，管理读写状态信息表，打开文件表，管理与组织存储设备上的文件目录结构，调用下一级存取控制模块。  </li>
<li>存取控制验证模块：<br>实现文件保护主要由该级软件完成，把用户访问和FCB中访问控制权限进行比较，确认合法性。  </li>
<li>逻辑文件系统和文件信息缓冲区：<br>根据文件逻辑把用户读写的记录转换成文件逻辑结构内相应块号。  </li>
<li>物理文件系统：<br>把逻辑记录所在的相对块号转换成实际物理地址。  </li>
<li>辅助分配模块：<br>管理辅存空间。  </li>
<li>设备管理程序模块：<br>分配设备，分配设备读写缓冲区，磁盘调度，启动设备，处理设备中断等。  <img src="/2022/052139833/10.jpg" class="">   
<h3 id="目录实现"><a href="#目录实现" class="headerlink" title="目录实现"></a>目录实现</h3>常用基本方法是线性列表和哈希表两种，目录实现的目的就是为了查找，因此对应线性查找和哈希查找。查询通过磁盘反复搜索完成的，开销大，复制进内存降低磁盘操作次数，提高系统速度。    </li>
<li>线性列表：<br>使用存储文件名和数据块指针的线性表。  </li>
<li>哈希表：<br>根据文件名得到值，返回一个指向线性列表中元素的指针。  <h3 id="文件实现——文件分配方式"><a href="#文件实现——文件分配方式" class="headerlink" title="文件实现——文件分配方式"></a>文件实现——文件分配方式</h3>文件分配对应文件的物理结构，如何为文件分配磁盘块，常见分配有连续分配，链接分配，索引分配。文件分配方式——对于磁盘非空闲块的管理。</li>
<li>连续分配：<br>要求每个文件在磁盘上占有一组连续的块，磁盘地址定义了磁盘上的一个线性排序，这种排序使得作业访问磁盘需要的寻道数和时间最小。一个文件目录条目包括开始的块的地址和长度。连续分配支持顺序访问和直接访问，优点就是实现简单，存取速度快，缺点就是文件长度不宜动态增加，反复增删产生外部碎片。  <img src="/2022/052139833/11.jpg" class="">   </li>
<li>链接分配：<br>离散分配的方式，消除外部碎片，增删改查方便，分为隐式链接和显式链接两种形式：<br>①隐式链接：<br>每个文件对应一个磁盘块链表，每个盘块都有指向下一个盘块的指针，这些指针对用户是透明的，目录包括文件的第一块指针和最后一块指针。创建新文件时，目录中增加一个新条目，每个目录项都有指向文件首块的指针，该指针初始化为NULL以表示空文件，写文件会同空闲空间管理系统找到空闲块，把该块链接到文件尾部，读文件则通过块间指针顺序读块。缺点就是无法直接访问，只能顺序访问，且软件/硬件错误导致指针丢失也会使得数据丢失。  <img src="/2022/052139833/12.jpg" class="">   
②显式链接指把用于连接文件各物理块的指针，从物理块末尾提取出来放在链接表中，仅一张称为文件分配表FAT，每个表项存放对应块的下一块指针，即下一个块号，第一个块号存在目录中，后续通过FAT查找得到。用-1表示文件最后一块，-2表示这个磁盘块是空闲的。因此FAT不仅记录了文件各块先后关系，还标记了空闲磁盘块。FAT在系统启动的时候就被读入内存，因此查找FAT是在内存中进行的，不仅显著提高了检索速度，而且减少了访问磁盘次数。  <img src="/2022/052139833/13.jpg" class="">   </li>
<li>索引分配：<br>链接分配不能解决直接访问，而索引分配解决了这个问题，它把每个文件所有盘块号都集中放在一起形成索引块。每个文件都由其索引块，这是一个磁盘块地址的数组，目录条目包括索引块的地址，第i块就是第i个条目的指针来查找和读入所需的块。创建文件时，所有索引块的指针都设置为空，首次写入第i块时需要从空闲空间中取得一个块，然后把其地址写入索引块的第i个条目。    <img src="/2022/052139833/14.jpg" class="">   
索引块大小很重要，每个文件必须有一个索引块，尽可能小，但太小无法支持大文件，采用以下机制解决问题：<br>①链接方案：多个索引块链接起来处理大文件。<br>②多层索引：第一层索引指向第二次，以此类推。<br>③混合索引：多种索引分配方式结合的分配方式</li>
<li>三种文件分配方式比较：  <img src="/2022/052139833/15.jpg" class="">   
<h3 id="文件实现——文件存储空间管理"><a href="#文件实现——文件存储空间管理" class="headerlink" title="文件实现——文件存储空间管理"></a>文件实现——文件存储空间管理</h3></li>
<li>文件存储器空间的划分与初始化：<br>一般来说，一个文件存储在一个文件卷中，文件卷可以是物理盘一部分，也可以是整个物理盘。一个文件卷中，文件数据信息的空间和存放文件控制信息FCB的空间时分离的。  <img src="/2022/052139833/16.jpg" class="">   </li>
<li>文件存储器空间管理：<br>文件存储设备分成大小相同的物理块，并以块为单位交换信息，因此文件存储设备的管理实质上是对空闲块的组织和管理，包括空闲块的组织，分配，回收等问题。  </li>
<li>空闲表法：<br>连续分配方式，为每个文件分配一块连续的内存空间，系统为外存的所有空闲区建立一张空闲盘块表，每个空闲区对应一个空闲表项，包括表项序号，该空闲区第一个盘块好，块数等信息，再递增排列。空闲盘区的分配和内存动态分配类似，同样采用首次适应算法/循环首次适应算法等。系统对用户释放的存储空间进行回收时，也采取类似用于内存回收的方法，考虑回收区是否和空闲表中插入点的前区和后区相邻接，对相邻接者予以合并。    <img src="/2022/052139833/17.jpg" class="">   </li>
<li>空闲链表法：<br>所有空闲盘区拉成一条空闲链，根据构成链所有基本元素不同，分为两种形式：空闲盘块链和空闲盘区链。<br>①空闲盘块链：把磁盘上所有空闲空间以盘块为单位拉成一条链，当用户因为创建文件而请求分配存储空间时，从链首开始一次摘下合适数目空闲盘块分配给用户，删除则把回收盘块放在链末尾。<br>②空闲盘区链：把磁盘上所有空闲空间以盘区为单位拉成一条链，盘区含有指向下一个盘区指针和盘区大小信息，分配和内存动态分配一样，采用首次适应算法，回收时也是把回收区和相邻接的空闲盘区合并。  </li>
<li>位示图法：<br>利用二进制的一位表示磁盘中的一个盘块的使用情况，0表示空闲，1表示已分配。分配和回收只需要修改二位数组的1/0即可。  <img src="/2022/052139833/18.jpg" class="">   </li>
<li>成组链接法：<br>UNIX使用，结合空闲表和空闲链表，克服表太大的缺点。思想:顺序的n个空扇区地址保存在第一个空扇区中，其后一个空闲扇区则保存另一个顺序空闲扇区的地址，之后一个空闲扇区内则保存另一个顺序空闲扇区的地址，如此继续，直到所有空闲扇区链接完成。  <img src="/2022/052139833/19.jpg" class="">   
<h2 id="磁盘组织与管理"><a href="#磁盘组织与管理" class="headerlink" title="磁盘组织与管理"></a>磁盘组织与管理</h2><h3 id="磁盘的结构"><a href="#磁盘的结构" class="headerlink" title="磁盘的结构"></a>磁盘的结构</h3><img src="/2022/052139833/20.jpg" class="">   
<h3 id="磁盘调度算法"><a href="#磁盘调度算法" class="headerlink" title="磁盘调度算法"></a>磁盘调度算法</h3>一次磁盘读写操作时间由寻道时间，旋转延迟时间，传输时间决定。  </li>
<li>寻道时间，活动头磁盘读信息之前，把磁头移动到指定磁道所需要的时间，这个时间除了跨越n条道的时间外，还包括启动磁臂的时间。  </li>
<li>旋转延迟时间，磁头定位到某磁道的扇区需要时间，设磁盘旋转速度为r，则t=1/2r。  </li>
<li>传输时间，从磁盘读出或向磁盘写入数据经历的时间，取决于每次读写字节数b和磁盘旋转速度t=b/rN。<br>其中寻道时间和磁盘调度算法相关，而其他都与磁盘旋转速度有关。以下几种磁盘调度算法：  </li>
<li>先来先服务FCFS：<br>按照先后顺序进行访问磁盘调度。  </li>
<li>最短寻找时间优先算法SSTF：<br>与当前磁道最近的磁道优先调度，但会产生“饥饿现象”。  </li>
<li>扫描算法SCAN：<br>在当前移动方向上寻找与当前磁头最近的对象，就是SSTF基础上规定了磁头运动方向。  </li>
<li>循环扫描算法C-SCAN：<br>扫描算法基础上规定磁头单项移动来提供服务，返回直接快速移动到起始端而不服务请求。</li>
<li>LOOK算法：<br>扫描算法就是磁头严格一个方向从一端到另一端，而改进之后磁头移动只需要到达最远端而不需要到达磁盘端点，这就是LOOK算法。（默认SCAN为LOOK算法）</li>
<li>C-LOOK算法：<br>对应C-SCAN类似，到达最远端点之后直接移动到起始端点而不提供服务请求。（默认C-SCAN为C-LOOK算法）</li>
<li>算法比较：  <img src="/2022/052139833/21.jpg" class="">   
<h3 id="磁盘的管理"><a href="#磁盘的管理" class="headerlink" title="磁盘的管理"></a>磁盘的管理</h3></li>
<li>磁盘初始化：<br>磁盘存储数据之前，必须分成扇区以便磁盘控制器能进行读和写的操作，这个过程称为低级格式化。低级格式化为磁盘的每个扇区采用特别的数据结构，每个扇区的数据结构通常由头，数据区域，尾部组成。为了使得磁盘存储文件，OS还需要把自己的数据结构记录在磁盘上，第一步把磁盘分为由一个或多个柱面组成的分区（C盘，D盘等），第二部对物理分区进行逻辑格式化（创建文件系统），OS把初始文件系统数据结构存储在磁盘上，这些数据结构包括空闲和已分配空间及一个初始为空的目录。  </li>
<li>引导块：计算机启动时运行初始化程序，初始化各类资源等，接着就启动OS。引导的这个自举程序的磁盘围殴启动磁盘/系统磁盘。    </li>
<li>坏块：硬件故障，OS处理不了。</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">FFFfrance</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://ffffrance.github.io/2022/052139833.html">http://ffffrance.github.io/2022/052139833.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">FFFfrance</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
                                    <span class="chip bg-color">操作系统</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/052237860.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/14.jpg" class="responsive-img" alt="操作系统输入/输出管理">
                        
                        <span class="card-title">操作系统输入/输出管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            操作系统输入-输出管理，概述，缓冲区，设备分配，SPOOLing系统（虚拟设备技术）。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-05-22
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="post-category">
                                    操作系统
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
                        <span class="chip bg-color">操作系统</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/05198490.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="操作系统内存管理">
                        
                        <span class="card-title">操作系统内存管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            操作系统内存管理，程序执行过程，连续分配，非连续分配，虚拟内存。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-05-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="post-category">
                                    操作系统
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
                        <span class="chip bg-color">操作系统</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="7402561500"
                   fixed='true'
                   autoplay='true'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.5'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <a href="/about" target="_blank">FFFfrance</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">71.2k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/ffffrance" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:605026336@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=605026336" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 605026336" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>
    <script src="/js/FunnyTitle.js"></script>
    
    

    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":false},"log":false});</script></body>

</html>
